# public.user_sessions

## Description

## Columns

| Name | Type | Default | Nullable | Children | Parents | Comment |
| ---- | ---- | ------- | -------- | -------- | ------- | ------- |
| id | character(26) | generate_ulid() | false |  |  |  |
| user_id | character(26) |  | false |  | [public.users](public.users.md) |  |
| session_token_hash | character(64) |  | false |  |  |  |
| refresh_token_hash | character(64) |  | true |  |  |  |
| ip_address | inet |  | false |  |  |  |
| user_agent_hash | character(64) |  | false |  |  |  |
| device_fingerprint | character(64) |  | true |  |  |  |
| expires_at | timestamp with time zone |  | false |  |  |  |
| refresh_expires_at | timestamp with time zone |  | true |  |  |  |
| last_activity_at | timestamp with time zone | now() | true |  |  |  |
| is_active | boolean | true | true |  |  |  |
| revoked_at | timestamp with time zone |  | true |  |  |  |
| revoked_reason | varchar(100) |  | true |  |  |  |
| created_at | timestamp with time zone | now() | true |  |  |  |

## Constraints

| Name | Type | Definition |
| ---- | ---- | ---------- |
| sessions_expires_check | CHECK | CHECK ((expires_at > created_at)) |
| user_sessions_user_id_fkey | FOREIGN KEY | FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE |
| user_sessions_pkey | PRIMARY KEY | PRIMARY KEY (id) |
| user_sessions_session_token_hash_key | UNIQUE | UNIQUE (session_token_hash) |

## Indexes

| Name | Definition |
| ---- | ---------- |
| user_sessions_pkey | CREATE UNIQUE INDEX user_sessions_pkey ON public.user_sessions USING btree (id) |
| user_sessions_session_token_hash_key | CREATE UNIQUE INDEX user_sessions_session_token_hash_key ON public.user_sessions USING btree (session_token_hash) |
| idx_sessions_token_hash | CREATE UNIQUE INDEX idx_sessions_token_hash ON public.user_sessions USING btree (session_token_hash) |
| idx_sessions_user_active | CREATE INDEX idx_sessions_user_active ON public.user_sessions USING btree (user_id, is_active, last_activity_at DESC) |
| idx_sessions_expires | CREATE INDEX idx_sessions_expires ON public.user_sessions USING btree (expires_at) WHERE (is_active = true) |
| idx_sessions_cleanup | CREATE INDEX idx_sessions_cleanup ON public.user_sessions USING btree (expires_at, is_active) WHERE (is_active = false) |

## Triggers

| Name | Definition |
| ---- | ---------- |
| trigger_reset_failed_attempts | CREATE TRIGGER trigger_reset_failed_attempts AFTER INSERT ON public.user_sessions FOR EACH ROW EXECUTE FUNCTION reset_failed_attempts_on_success() |

## Relations

```mermaid
erDiagram

"public.user_sessions" }o--|| "public.users" : "FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE"

"public.user_sessions" {
  character_26_ id
  character_26_ user_id FK
  character_64_ session_token_hash
  character_64_ refresh_token_hash
  inet ip_address
  character_64_ user_agent_hash
  character_64_ device_fingerprint
  timestamp_with_time_zone expires_at
  timestamp_with_time_zone refresh_expires_at
  timestamp_with_time_zone last_activity_at
  boolean is_active
  timestamp_with_time_zone revoked_at
  varchar_100_ revoked_reason
  timestamp_with_time_zone created_at
}
"public.users" {
  character_26_ id
  varchar_50_ username
  bytea email_encrypted
  character_64_ email_hash
  varchar_255_ password_hash
  varchar_100_ display_name
  varchar_500_ avatar_url
  text bio
  varchar_500_ website_url
  varchar_50_ timezone
  varchar_10_ language
  varchar_20_ theme
  boolean email_notifications
  boolean weekly_digest
  boolean trending_alerts
  integer failed_login_attempts
  timestamp_with_time_zone locked_until
  timestamp_with_time_zone last_password_change
  character_64_ password_reset_token_hash
  timestamp_with_time_zone password_reset_expires_at
  character_64_ email_verification_token_hash
  timestamp_with_time_zone email_verified_at
  timestamp_with_time_zone last_login_at
  timestamp_with_time_zone last_activity_at
  integer articles_read_count
  integer bookmarks_count
  boolean is_active
  boolean is_admin
  timestamp_with_time_zone created_at
  timestamp_with_time_zone updated_at
  character_26_ created_by
  character_26_ updated_by
}
```

---

> Generated by [tbls](https://github.com/k1LoW/tbls)
