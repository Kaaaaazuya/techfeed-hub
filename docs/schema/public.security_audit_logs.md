# public.security_audit_logs

## Description

## Columns

| Name | Type | Default | Nullable | Children | Parents | Comment |
| ---- | ---- | ------- | -------- | -------- | ------- | ------- |
| id | character(26) | generate_ulid() | false |  |  |  |
| event_type | varchar(50) |  | false |  |  |  |
| event_category | varchar(30) |  | false |  |  |  |
| severity | varchar(10) | 'INFO'::character varying | false |  |  |  |
| user_id | character(26) |  | true |  | [public.users](public.users.md) |  |
| target_type | varchar(50) |  | true |  |  |  |
| target_id | character(26) |  | true |  |  |  |
| session_id | character(26) |  | true |  |  |  |
| request_id | character(26) |  | false |  |  |  |
| ip_address | inet |  | false |  |  |  |
| user_agent_hash | character(64) |  | false |  |  |  |
| action_description | text |  | false |  |  |  |
| old_values_hash | character(64) |  | true |  |  |  |
| new_values_hash | character(64) |  | true |  |  |  |
| success | boolean |  | false |  |  |  |
| error_code | varchar(50) |  | true |  |  |  |
| error_message | text |  | true |  |  |  |
| processing_time_ms | integer |  | true |  |  |  |
| occurred_at | timestamp with time zone | now() | false |  |  |  |

## Constraints

| Name | Type | Definition |
| ---- | ---- | ---------- |
| audit_immutable_check | CHECK | CHECK ((occurred_at <= now())) |
| security_audit_logs_user_id_fkey | FOREIGN KEY | FOREIGN KEY (user_id) REFERENCES users(id) |
| security_audit_logs_pkey | PRIMARY KEY | PRIMARY KEY (id, occurred_at) |

## Indexes

| Name | Definition |
| ---- | ---------- |
| security_audit_logs_pkey | CREATE UNIQUE INDEX security_audit_logs_pkey ON ONLY public.security_audit_logs USING btree (id, occurred_at) |
| idx_audit_user_time | CREATE INDEX idx_audit_user_time ON ONLY public.security_audit_logs USING btree (user_id, occurred_at DESC) |
| idx_audit_event_severity | CREATE INDEX idx_audit_event_severity ON ONLY public.security_audit_logs USING btree (event_type, severity, occurred_at DESC) |
| idx_audit_ip_time | CREATE INDEX idx_audit_ip_time ON ONLY public.security_audit_logs USING btree (ip_address, occurred_at DESC) |
| idx_audit_failed_auth | CREATE INDEX idx_audit_failed_auth ON ONLY public.security_audit_logs USING btree (event_category, success, occurred_at DESC) WHERE (((event_category)::text = 'AUTH'::text) AND (success = false)) |

## Relations

```mermaid
erDiagram

"public.security_audit_logs" }o--o| "public.users" : "FOREIGN KEY (user_id) REFERENCES users(id)"

"public.security_audit_logs" {
  character_26_ id
  varchar_50_ event_type
  varchar_30_ event_category
  varchar_10_ severity
  character_26_ user_id FK
  varchar_50_ target_type
  character_26_ target_id
  character_26_ session_id
  character_26_ request_id
  inet ip_address
  character_64_ user_agent_hash
  text action_description
  character_64_ old_values_hash
  character_64_ new_values_hash
  boolean success
  varchar_50_ error_code
  text error_message
  integer processing_time_ms
  timestamp_with_time_zone occurred_at
}
"public.users" {
  character_26_ id
  varchar_50_ username
  bytea email_encrypted
  character_64_ email_hash
  varchar_255_ password_hash
  varchar_100_ display_name
  varchar_500_ avatar_url
  text bio
  varchar_500_ website_url
  varchar_50_ timezone
  varchar_10_ language
  varchar_20_ theme
  boolean email_notifications
  boolean weekly_digest
  boolean trending_alerts
  integer failed_login_attempts
  timestamp_with_time_zone locked_until
  timestamp_with_time_zone last_password_change
  character_64_ password_reset_token_hash
  timestamp_with_time_zone password_reset_expires_at
  character_64_ email_verification_token_hash
  timestamp_with_time_zone email_verified_at
  timestamp_with_time_zone last_login_at
  timestamp_with_time_zone last_activity_at
  integer articles_read_count
  integer bookmarks_count
  boolean is_active
  boolean is_admin
  timestamp_with_time_zone created_at
  timestamp_with_time_zone updated_at
  character_26_ created_by
  character_26_ updated_by
}
```

---

> Generated by [tbls](https://github.com/k1LoW/tbls)
